import { ImageResponse } from '@vercel/og'

import { siteConfig } from '@/data/site'

export const config = {
  runtime: 'edge',
}

const interRegular = fetch(
  new URL('../../../../public/fonts/inter/Inter-Regular.otf', import.meta.url)
).then((res) => res.arrayBuffer())

const interBold = fetch(
  new URL('../../../../public/fonts/inter/Inter-Bold.otf', import.meta.url)
).then((res) => res.arrayBuffer())

export default async function handler(request) {
  try {
    // Make sure the font exists in the specified path:
    const [interRegularFont, interBoldFont] = await Promise.all([
      interRegular,
      interBold,
    ])

    const { searchParams } = new URL(request.url)

    // ?title=<title>
    const hasTitle = searchParams.has('title')
    const title = hasTitle
      ? searchParams.get('title')?.slice(0, 100)
      : siteConfig.docsSiteName

    // ?description=<description>
    const hasDescription = searchParams.has('description')
    const description = hasDescription
      ? searchParams.get('description')?.slice(0, 175).length < 175
        ? `${searchParams.get('description')?.slice(0, 175)}`
        : `${searchParams.get('description')?.slice(0, 175)} ...`
      : siteConfig.docsSiteDescription

    return new ImageResponse(
      (
        <div tw="relative flex flex-col w-full h-full bg-[#151719]">
          <div tw="absolute flex top-0 left-0">
            <svg
              width="1200"
              height="630"
              viewBox="0 0 1200 630"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <g clip-path="url(#clip0_508_2306)">
                <g opacity="0.6" filter="url(#filter0_f_508_2306)">
                  <ellipse
                    cx="1219"
                    cy="20"
                    rx="148"
                    ry="44"
                    transform="rotate(-90 1219 20)"
                    fill="#FFB224"
                  />
                </g>
                <g opacity="0.6" filter="url(#filter1_f_508_2306)">
                  <ellipse
                    cx="742.5"
                    cy="76"
                    rx="476.5"
                    ry="45"
                    fill="#0092FF"
                  />
                </g>
                <g opacity="0.2" filter="url(#filter2_f_508_2306)">
                  <circle cx="77" cy="680" r="281" fill="#0954A5" />
                </g>
              </g>
              <defs>
                <filter
                  id="filter0_f_508_2306"
                  x="875"
                  y="-428"
                  width="688"
                  height="896"
                  filterUnits="userSpaceOnUse"
                  color-interpolation-filters="sRGB"
                >
                  <feFlood flood-opacity="0" result="BackgroundImageFix" />
                  <feBlend
                    mode="normal"
                    in="SourceGraphic"
                    in2="BackgroundImageFix"
                    result="shape"
                  />
                  <feGaussianBlur
                    stdDeviation="150"
                    result="effect1_foregroundBlur_508_2306"
                  />
                </filter>
                <filter
                  id="filter1_f_508_2306"
                  x="-34"
                  y="-269"
                  width="1553"
                  height="690"
                  filterUnits="userSpaceOnUse"
                  color-interpolation-filters="sRGB"
                >
                  <feFlood flood-opacity="0" result="BackgroundImageFix" />
                  <feBlend
                    mode="normal"
                    in="SourceGraphic"
                    in2="BackgroundImageFix"
                    result="shape"
                  />
                  <feGaussianBlur
                    stdDeviation="150"
                    result="effect1_foregroundBlur_508_2306"
                  />
                </filter>
                <filter
                  id="filter2_f_508_2306"
                  x="-504"
                  y="99"
                  width="1162"
                  height="1162"
                  filterUnits="userSpaceOnUse"
                  color-interpolation-filters="sRGB"
                >
                  <feFlood flood-opacity="0" result="BackgroundImageFix" />
                  <feBlend
                    mode="normal"
                    in="SourceGraphic"
                    in2="BackgroundImageFix"
                    result="shape"
                  />
                  <feGaussianBlur
                    stdDeviation="150"
                    result="effect1_foregroundBlur_508_2306"
                  />
                </filter>
                <clipPath id="clip0_508_2306">
                  <rect width="1200" height="630" fill="white" />
                </clipPath>
              </defs>
            </svg>
          </div>
          <div tw="relative flex flex-col w-full px-16 py-20">
            <div tw="flex h-12">
              <svg
                width="239"
                height="48"
                viewBox="0 0 239 48"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M0 7.19354C0 3.22066 3.22066 0 7.19355 0H40.8065C44.7793 0 48 3.22066 48 7.19355V40.8065C48 44.7793 44.7793 48 40.8065 48H7.19354C3.22066 48 0 44.7793 0 40.8065V7.19354Z"
                  fill="#212526"
                />
                <path
                  d="M5.95068 15.4533C5.95068 14.3221 5.95068 13.7565 6.3021 13.4051C6.65351 13.0537 7.21911 13.0537 8.35029 13.0537H39.6892C40.8204 13.0537 41.386 13.0537 41.7374 13.4051C42.0888 13.7565 42.0888 14.3221 42.0888 15.4533V17.373C42.0888 18.5042 42.0888 19.0698 41.7374 19.4212C41.386 19.7726 40.8204 19.7726 39.6892 19.7726H8.3503C7.21911 19.7726 6.65351 19.7726 6.3021 19.4212C5.95068 19.0698 5.95068 18.5042 5.95068 17.373V15.4533Z"
                  fill="url(#paint0_linear_508_2325)"
                />
                <path
                  d="M12.8135 24.572C12.8135 23.4408 12.8135 22.8752 13.1649 22.5238C13.5163 22.1724 14.0819 22.1724 15.2131 22.1724H32.8262C33.9574 22.1724 34.523 22.1724 34.8744 22.5238C35.2258 22.8752 35.2258 23.4408 35.2258 24.572V26.4917C35.2258 27.6228 35.2258 28.1884 34.8744 28.5399C34.523 28.8913 33.9574 28.8913 32.8262 28.8913H15.2131C14.0819 28.8913 13.5163 28.8913 13.1649 28.5399C12.8135 28.1884 12.8135 27.6228 12.8135 26.4917V24.572Z"
                  fill="url(#paint1_linear_508_2325)"
                />
                <path
                  d="M19.1965 33.6906C19.1965 32.5594 19.1965 31.9938 19.5479 31.6424C19.8994 31.291 20.465 31.291 21.5961 31.291H26.4434C27.5745 31.291 28.1401 31.291 28.4916 31.6424C28.843 31.9938 28.843 32.5594 28.843 33.6906V35.6103C28.843 36.7415 28.843 37.3071 28.4916 37.6585C28.1401 38.0099 27.5745 38.0099 26.4434 38.0099H21.5961C20.465 38.0099 19.8994 38.0099 19.5479 37.6585C19.1965 37.3071 19.1965 36.7415 19.1965 35.6103V33.6906Z"
                  fill="url(#paint2_linear_508_2325)"
                />
                <path
                  d="M72.1088 39.3416C69.8547 39.3416 68.0485 38.7925 66.6902 37.6944C65.332 36.5962 64.6529 34.6456 64.6529 31.8424V22.4791H60.9683V17.8409H64.6529L65.3031 12.0756H70.2014V17.8409H76.0101V22.4791H70.2014V31.8857C70.2014 32.9261 70.4182 33.6486 70.8517 34.0531C71.3141 34.4288 72.0943 34.6167 73.1925 34.6167H75.8801V39.3416H72.1088Z"
                  fill="white"
                />
                <path
                  d="M82.8981 14.5031C81.8866 14.5031 81.0486 14.1996 80.3839 13.5927C79.7481 12.9859 79.4302 12.22 79.4302 11.2953C79.4302 10.3705 79.7481 9.61915 80.3839 9.04117C81.0486 8.4343 81.8866 8.13086 82.8981 8.13086C83.9095 8.13086 84.7332 8.4343 85.3689 9.04117C86.0336 9.61915 86.3659 10.3705 86.3659 11.2953C86.3659 12.22 86.0336 12.9859 85.3689 13.5927C84.7332 14.1996 83.9095 14.5031 82.8981 14.5031ZM80.1238 39.3416V17.8409H85.6724V39.3416H80.1238Z"
                  fill="white"
                />
                <path
                  d="M101.044 39.8618C98.8763 39.8618 96.9546 39.3994 95.2784 38.4747C93.6023 37.5499 92.2874 36.2494 91.3337 34.5733C90.3801 32.8972 89.9032 30.961 89.9032 28.7646C89.9032 26.5394 90.3656 24.5599 91.2904 22.8259C92.244 21.092 93.5445 19.7482 95.1917 18.7945C96.8679 17.812 98.833 17.3207 101.087 17.3207C103.197 17.3207 105.061 17.7831 106.679 18.7078C108.297 19.6326 109.554 20.9042 110.45 22.5225C111.375 24.1119 111.837 25.8892 111.837 27.8543C111.837 28.1722 111.823 28.5046 111.794 28.8513C111.794 29.1981 111.78 29.5594 111.751 29.935H95.4085C95.5241 31.6112 96.102 32.9261 97.1424 33.8797C98.2117 34.8334 99.4977 35.3102 101 35.3102C102.127 35.3102 103.067 35.0646 103.818 34.5733C104.598 34.0531 105.176 33.3885 105.552 32.5793H111.187C110.783 33.9375 110.104 35.1802 109.15 36.3072C108.225 37.4054 107.069 38.2724 105.682 38.9081C104.324 39.5439 102.778 39.8618 101.044 39.8618ZM101.087 21.8289C99.7288 21.8289 98.5295 22.2191 97.4892 22.9993C96.4488 23.7507 95.7842 24.9066 95.4952 26.4672H106.202C106.115 25.0511 105.595 23.9241 104.642 23.086C103.688 22.2479 102.503 21.8289 101.087 21.8289Z"
                  fill="white"
                />
                <path
                  d="M115.637 39.3416V17.8409H120.579L121.099 21.8723C121.879 20.4851 122.934 19.387 124.264 18.5778C125.622 17.7397 127.211 17.3207 129.032 17.3207V23.1727H127.471C126.258 23.1727 125.174 23.3606 124.22 23.7362C123.267 24.1119 122.515 24.7622 121.966 25.6869C121.446 26.6117 121.186 27.8977 121.186 29.5449V39.3416H115.637Z"
                  fill="white"
                />
                <path
                  d="M152.724 39.7297C150.702 39.7297 148.897 39.2387 147.309 38.2568C145.72 37.2748 144.464 35.9319 143.54 34.2279C142.615 32.5239 142.153 30.5889 142.153 28.4229C142.153 26.2568 142.615 24.3362 143.54 22.6611C144.464 20.9572 145.72 19.6287 147.309 18.6756C148.897 17.6936 150.702 17.2027 152.724 17.2027C154.341 17.2027 155.756 17.5059 156.969 18.1124C158.182 18.7189 159.164 19.5709 159.915 20.6684V8.01855H165.46V39.2099H160.522L159.915 36.134C159.222 37.0871 158.298 37.9247 157.142 38.6467C156.016 39.3687 154.543 39.7297 152.724 39.7297ZM153.893 34.8777C155.684 34.8777 157.142 34.2857 158.269 33.1016C159.424 31.8886 160.002 30.3434 160.002 28.4662C160.002 26.5889 159.424 25.0582 158.269 23.8741C157.142 22.6611 155.684 22.0546 153.893 22.0546C152.132 22.0546 150.673 22.6467 149.518 23.8308C148.363 25.0149 147.785 26.5456 147.785 28.4229C147.785 30.3001 148.363 31.8452 149.518 33.0582C150.673 34.2712 152.132 34.8777 153.893 34.8777Z"
                  fill="#687076"
                />
                <path
                  d="M180.551 39.7297C178.471 39.7297 176.594 39.2532 174.919 38.3001C173.273 37.347 171.959 36.033 170.977 34.3579C170.024 32.6539 169.547 30.69 169.547 28.4662C169.547 26.2424 170.038 24.2929 171.02 22.6178C172.002 20.9138 173.316 19.5853 174.962 18.6323C176.637 17.6792 178.515 17.2027 180.594 17.2027C182.645 17.2027 184.493 17.6792 186.139 18.6323C187.814 19.5853 189.128 20.9138 190.082 22.6178C191.063 24.2929 191.554 26.2424 191.554 28.4662C191.554 30.69 191.063 32.6539 190.082 34.3579C189.128 36.033 187.814 37.347 186.139 38.3001C184.464 39.2532 182.601 39.7297 180.551 39.7297ZM180.551 34.9211C181.995 34.9211 183.251 34.3868 184.32 33.3182C185.388 32.2207 185.923 30.6034 185.923 28.4662C185.923 26.329 185.388 24.7261 184.32 23.6575C183.251 22.5601 182.009 22.0113 180.594 22.0113C179.121 22.0113 177.85 22.5601 176.782 23.6575C175.742 24.7261 175.222 26.329 175.222 28.4662C175.222 30.6034 175.742 32.2207 176.782 33.3182C177.85 34.3868 179.107 34.9211 180.551 34.9211Z"
                  fill="#687076"
                />
                <path
                  d="M206.173 39.7297C203.978 39.7297 202.043 39.2532 200.368 38.3001C198.693 37.347 197.364 36.0185 196.382 34.3146C195.429 32.6106 194.953 30.6611 194.953 28.4662C194.953 26.2712 195.429 24.3218 196.382 22.6178C197.364 20.9138 198.693 19.5853 200.368 18.6323C202.043 17.6792 203.978 17.2027 206.173 17.2027C208.917 17.2027 211.227 17.9247 213.104 19.3687C214.982 20.7839 216.18 22.7478 216.7 25.2604H210.852C210.563 24.2207 209.985 23.412 209.119 22.8344C208.281 22.2279 207.285 21.9247 206.13 21.9247C204.599 21.9247 203.299 22.5023 202.231 23.6575C201.162 24.8128 200.628 26.4156 200.628 28.4662C200.628 30.5167 201.162 32.1196 202.231 33.2748C203.299 34.4301 204.599 35.0077 206.13 35.0077C207.285 35.0077 208.281 34.7189 209.119 34.1413C209.985 33.5637 210.563 32.7405 210.852 31.672H216.7C216.18 34.0979 214.982 36.0474 213.104 37.5203C211.227 38.9933 208.917 39.7297 206.173 39.7297Z"
                  fill="#687076"
                />
                <path
                  d="M229.636 39.7297C227.73 39.7297 226.055 39.4265 224.611 38.82C223.167 38.1846 222.012 37.3182 221.145 36.2207C220.279 35.1232 219.759 33.8525 219.586 32.4084H225.174C225.347 33.246 225.809 33.968 226.56 34.5745C227.34 35.1521 228.337 35.4409 229.55 35.4409C230.763 35.4409 231.643 35.1954 232.192 34.7044C232.77 34.2135 233.059 33.6503 233.059 33.0149C233.059 32.0907 232.654 31.4698 231.846 31.1521C231.037 30.8055 229.911 30.4734 228.467 30.1557C227.542 29.9536 226.604 29.7081 225.651 29.4193C224.698 29.1304 223.817 28.7694 223.008 28.3362C222.228 27.8741 221.593 27.2965 221.102 26.6034C220.611 25.8814 220.365 25.0005 220.365 23.9608C220.365 22.0546 221.116 20.4518 222.618 19.1521C224.149 17.8525 226.286 17.2027 229.03 17.2027C231.571 17.2027 233.593 17.7947 235.095 18.9788C236.625 20.1629 237.535 21.7947 237.824 23.8741H232.582C232.264 22.2857 231.066 21.4915 228.986 21.4915C227.947 21.4915 227.138 21.6936 226.56 22.098C226.012 22.5023 225.737 23.0077 225.737 23.6142C225.737 24.2496 226.156 24.755 226.994 25.1305C227.831 25.5059 228.943 25.8525 230.329 26.1702C231.831 26.5167 233.203 26.9066 234.445 27.3398C235.716 27.7442 236.726 28.3651 237.477 29.2026C238.228 30.0113 238.604 31.181 238.604 32.7117C238.633 34.0402 238.286 35.2387 237.564 36.3073C236.842 37.3759 235.802 38.2135 234.445 38.82C233.087 39.4265 231.485 39.7297 229.636 39.7297Z"
                  fill="#687076"
                />
                <defs>
                  <linearGradient
                    id="paint0_linear_508_2325"
                    x1="43.9845"
                    y1="13.0537"
                    x2="-0.900193"
                    y2="37.4937"
                    gradientUnits="userSpaceOnUse"
                  >
                    <stop stop-color="#0085FF" />
                    <stop offset="1" stop-color="#00FFF0" />
                  </linearGradient>
                  <linearGradient
                    id="paint1_linear_508_2325"
                    x1="15.2971"
                    y1="14.6976"
                    x2="35.2258"
                    y2="34.8183"
                    gradientUnits="userSpaceOnUse"
                  >
                    <stop stop-color="#F36AFF" />
                    <stop offset="1" stop-color="#FF0000" />
                  </linearGradient>
                  <linearGradient
                    id="paint2_linear_508_2325"
                    x1="29.3949"
                    y1="33.8946"
                    x2="17.4688"
                    y2="38.0099"
                    gradientUnits="userSpaceOnUse"
                  >
                    <stop stop-color="#FFD852" />
                    <stop offset="1" stop-color="#FF7A00" />
                  </linearGradient>
                </defs>
              </svg>
            </div>
            <div tw="flex flex-col pt-32">
              <h1 tw="flex text-[#FFFFFF] font-bold text-7xl">{title}</h1>
              <p tw="flex text-4xl leading-normal text-[#FFFFFF]">
                {description}
              </p>
            </div>
          </div>
        </div>
      ),
      {
        width: 1200,
        height: 630,
        fonts: [
          {
            name: 'Inter',
            data: interRegularFont,
            style: 'normal',
            weight: 400,
          },
          {
            name: 'Inter',
            data: interBoldFont,
            style: 'normal',
            weight: 700,
          },
        ],
      }
    )
  } catch (e) {
    console.log(`${e.message}`)
    return new Response(`Failed to generate the image`, {
      status: 500,
    })
  }
}
